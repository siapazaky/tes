let levelling = require('../lib/levelling') 
 let fs = require('fs') 
 let path = require('path') 
 let fetch = require('node-fetch') 
 let moment = require('moment-timezone') 
 let jimp = require('jimp') 
 let PhoneNumber = require('awesome-phonenumber') 
 letÂ tagsÂ =Â {} 
 constÂ defaultMenuÂ =Â { 
 Â Â before: `ä¹‚ *USER*
Ã— Name *%name!*
Ã— Waktu:  *%time* 
Ã— Name Bot: *%me*
Ã— Uptime:  *%uptime*
Ã— Owner :  *@${global.owner[0].split('@')[0]}*
Ã— Memory Used :  *${(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)}MB / ${Math.round(require('os').totalmem / 1024 / 1024)}MB* 
%readmore`.trim(),
  header: `ê—ƒ %category .á­¡`, 
   body: 'â—¦  %cmd %islimit %isPremium', 
   footer: '\n', 
   after: ``,
}
  
 letÂ handlerÂ =Â asyncÂ (m,Â {Â conn,Â usedPrefix:Â _pÂ })Â =>Â { 
 Â Â tryÂ { 
 Â Â Â Â letÂ nameÂ =Â m.pushNameÂ ||Â conn.getName(m.sender) 
 Â Â Â Â letÂ dÂ =Â newÂ Date(newÂ DateÂ +Â 3600000) 
 Â Â Â Â letÂ localeÂ =Â 'en' 
 Â Â Â Â //Â d.getTimeZoneOffset() 
 Â Â Â Â //Â OffsetÂ -420Â isÂ 18.00 
 Â Â Â Â //Â OffsetÂ Â Â Â 0Â isÂ Â 0.00 
 Â Â Â Â //Â OffsetÂ Â 420Â isÂ Â 7.00 
 Â Â Â Â letÂ dateÂ =Â d.toLocaleDateString(locale,Â { 
 Â Â Â Â Â Â day:Â 'numeric', 
 Â Â Â Â Â Â month:Â 'long', 
 Â Â Â Â Â Â year:Â 'numeric', 
 Â Â Â Â Â Â timeZone:Â 'Asia/Jakarta' 
 Â Â Â Â }) 
 Â Â Â Â letÂ timeÂ =Â d.toLocaleTimeString(locale,Â {Â timeZone:Â 'Asia/Jakarta'Â }) 
 Â Â Â Â timeÂ =Â time.replace(/[.]/g,Â ':') 
 Â Â Â Â letÂ _uptime 
 Â Â Â Â ifÂ (process.send)Â { 
 Â Â Â Â Â Â process.send('uptime') 
 Â Â Â Â Â Â _uptimeÂ =Â awaitÂ newÂ Promise(resolveÂ =>Â { 
 Â Â Â Â Â Â Â Â process.once('message',Â resolve) 
 Â Â Â Â Â Â Â Â setTimeout(resolve,Â 1000) 
 Â Â Â Â Â Â })Â *Â 1000 
 Â Â Â Â } 
     let sender = m.sender
     let pp = await conn.profilePictureUrl(sender, 'image').catch((_) => "https://telegra.ph/file/24fa902ead26340f3df2c.png")
 Â Â Â Â letÂ resÂ =Â awaitÂ fetch('https://raw.githubusercontent.com/ArugaZ/grabbed-results/main/random/anime/neko.txt') 
 Â Â Â Â letÂ txtÂ =Â awaitÂ res.text() 
 Â Â Â Â letÂ arrÂ =Â txt.split('\n') 
 Â Â Â Â letÂ citaÂ =Â arr[Math.floor(Math.random()Â *Â arr.length)] 
 Â Â Â Â letÂ thumbÂ =Â await(awaitÂ fetch(cita)).buffer() 
 Â Â Â Â Â Â letÂ vnÂ =Â './media/tante-tante.mp3' 
 Â Â Â Â letÂ uptimeÂ =Â clockString(_uptime) 
 Â Â Â Â letÂ helpÂ =Â Object.values(global.plugins).filter(pluginÂ =>Â !plugin.disabled).map(pluginÂ =>Â { 
 Â Â Â Â Â Â returnÂ { 
 Â Â Â Â Â Â Â Â help:Â Array.isArray(plugin.tags)Â ?Â plugin.helpÂ :Â [plugin.help], 
 Â Â Â Â Â Â Â Â tags:Â Array.isArray(plugin.tags)Â ?Â plugin.tagsÂ :Â [plugin.tags], 
 Â Â Â Â Â Â Â Â prefix:Â 'customPrefix'Â inÂ plugin, 
 Â Â Â Â Â Â Â Â limit:Â plugin.limit, 
 Â Â Â Â Â Â Â Â premium:Â plugin.premium, 
 Â Â Â Â Â Â Â Â enabled:Â !plugin.disabled, 
 Â Â Â Â Â Â } 
 Â Â Â Â }) 
 Â Â Â Â forÂ (letÂ pluginÂ ofÂ help) 
 Â Â Â Â Â Â ifÂ (pluginÂ &&Â 'tags'Â inÂ plugin) 
 Â Â Â Â Â Â Â Â forÂ (letÂ tagÂ ofÂ plugin.tags) 
 Â Â Â Â Â Â Â Â Â Â ifÂ (!(tagÂ inÂ tags)Â &&Â tag)Â tags[tag]Â =Â tag 
 Â Â Â Â conn.menuÂ =Â conn.menuÂ ?Â conn.menuÂ :Â {} 
 Â Â Â Â letÂ beforeÂ =Â conn.menu.beforeÂ ||Â defaultMenu.before 
 Â Â Â Â letÂ headerÂ =Â conn.menu.headerÂ ||Â defaultMenu.header 
 Â Â Â Â letÂ bodyÂ =Â conn.menu.bodyÂ ||Â defaultMenu.body 
 Â Â Â Â letÂ footerÂ =Â conn.menu.footerÂ ||Â defaultMenu.footer 
 Â Â Â Â letÂ afterÂ =Â conn.menu.afterÂ ||Â defaultMenu.after 
 Â Â Â Â letÂ _textÂ =Â [ 
 Â Â Â Â Â Â before, 
 Â Â Â Â Â Â ...Object.keys(tags).map(tagÂ =>Â { 
 Â Â Â Â Â Â Â Â returnÂ header.replace(/%category/g,Â tags[tag].toUpperCase())Â +Â '\n'Â +Â [ 
 Â Â Â Â Â Â Â Â Â Â ...help.filter(menuÂ =>Â menu.tagsÂ &&Â menu.tags.includes(tag)Â &&Â menu.help).map(menuÂ =>Â { 
 Â Â Â Â Â Â Â Â Â Â Â Â returnÂ menu.help.map(helpÂ =>Â { 
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ body.replace(/%cmd/g,Â menu.prefixÂ ?Â helpÂ :Â '%p'Â +Â help) 
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .replace(/%islimit/g,Â menu.limitÂ ?Â 'â“'Â :Â '') 
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .replace(/%isPremium/g,Â menu.premiumÂ ?Â 'â“…'Â :Â '') 
 Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .trim() 
 Â Â Â Â Â Â Â Â Â Â Â Â }).join('\n') 
 Â Â Â Â Â Â Â Â Â Â }), 
 Â Â Â Â Â Â Â Â Â Â footer 
 Â Â Â Â Â Â Â Â ].join('\n') 
 Â Â Â Â Â Â }), 
 Â Â Â Â Â Â after 
 Â Â Â Â ].join('\n') 
 Â Â Â Â letÂ textÂ =Â typeofÂ conn.menuÂ ==Â 'string'Â ?Â conn.menuÂ :Â typeofÂ conn.menuÂ ==Â 'object'Â ?Â _textÂ :Â '' 
 Â Â Â Â letÂ replaceÂ =Â { 
 Â Â Â Â Â Â '%':Â '%', 
 Â Â Â Â Â Â p:Â _p,Â uptime, 
 Â Â Â Â Â Â me:Â conn.getName(conn.user.jid), 
 Â Â Â Â Â Â name,Â date,Â time, 
 Â Â Â Â Â Â readmore:Â readMore 
 Â Â Â Â } 
 Â Â Â Â letÂ fkonÂ =Â {Â key:Â {Â fromMe:Â false,Â participant: `0@s.whatsapp.net`, ...(m.chat ? { remoteJid: "6282331033919-1625305606@g.us"Â }Â :Â {})Â },Â message:Â {Â contactMessage:Â {Â displayName:Â `${name}`,Â vcard:Â `BEGIN:VCARD\nVERSION:3.0\nN:;a,;;;\nFN:${name}\nitem1.TEL;waid=${m.sender.split('@')[0]}:${m.sender.split('@')[0]}\nitem1.X-ABLabel:Ponsel\nEND:VCARD`}}}
     const ziv = {
	 key: { 
          fromMe: false,
	      participant: `0@s.whatsapp.net`, ...(m.chat ? 
	 { remoteJid: "6282331033919-1625305606@g.us" } : {}) 
                },
	 message: { 
		"extendedTextMessage": {
                 "text":`ðŸ’Œ Contact : ${name}
` + wm2,
                 'jpegThumbnail': awaitÂ conn.resize(pp, 300,Â 300)
                        }
	                  } 
                     }
let tqto = `*BIG THANKS TO*
â€¢ God
â€¢ My ortu
â€¢ Zivfurr / Ziv San ( Me )
â€¢ The.sad.boy01
â€¢ ZiXyz Team` 
 Â Â Â Â textÂ =Â text.replace(newÂ RegExp(`%(${Object.keys(replace).sort((a,Â b)Â =>Â b.lengthÂ -Â a.length).join`|`})`,Â 'g'),Â (_,Â name)Â =>Â ''Â +Â replace[name])
conn.send2ButtonDoc(m.chat, text.trim(), tqto,  'DASHBORD', '.dashbord', 'RULES', '.rules', m, { 
     quoted: ziv, 
     contextInfo: { 
         externalAdReply :{ showAdAttribution: true, 
    mediaType: 1,
    title: 'Simple Bot Whatsapp By Ziv San',
    body: 'Follow Me On Tiktok',
    thumbnail: await(await fetch('https://telegra.ph/file/758838517375f2493ad06.jpg')).buffer(),
    renderLargerThumbnail: true, 
    mediaUrl: 'https://youtu.be/dcZWxOPAItU',
    sourceUrl: `https://www.tiktok.com/@colindonesia?_t=8VRaB1ZSiI6&_r=1`
     }}
    })
} catch (e) { 
     conn.reply(m.chat, 'Maaf, menu sedang error', m) 
     throw e 
   } 
 } 
 handler.help = ['menu', 'help', '?'] 
 handler.tags = ['main'] 
 handler.command = /^(m(enu)?|help|\?)$/i 
 handler.owner = false 
 handler.mods = false 
 handler.premium = false 
 handler.group = false 
 handler.private = false 
  
 handler.admin = false 
 handler.botAdmin = false 
  
 handler.fail = null 
 handler.exp = 3 
  
 module.exports = handler 
  
 const more = String.fromCharCode(8206) 
 const readMore = more.repeat(4001) 
  
 function clockString(ms) { 
   let h = isNaN(ms) ? '--' : Math.floor(ms / 3600000) 
   let m = isNaN(ms) ? '--' : Math.floor(ms / 60000) % 60 
   let s = isNaN(ms) ? '--' : Math.floor(ms / 1000) % 60 
   return [h, m, s].map(v => v.toString().padStart(2, 0)).join(':') 
 } 
 function logos() { 
   const lgs = moment.tz('Asia/Jakarta').format('HH') 
   res = "Selamat dinihari" 
   if (lgs >= 4) { 
     imp = 'https://telegra.ph/file/abff7903bd674a8f9d307.jpg' 
   } 
   if (lgs > 10) { 
     imp = 'https://telegra.ph/file/ba940019735e224132f74.jpg' 
   } 
   if (lgs >= 15) { 
     imp = 'https://telegra.ph/file/a332bbac803e3c631bb07.jpg' 
   } 
   if (lgs >= 18) { 
     imp = 'https://telegra.ph/file/a5c91ab6c58c7be066654.jpg' 
   } 
   return imp 
 } 
 function dimas() { 
   const varel = moment.tz('Asia/Jakarta').format('HH') 
   res = "Selamat dinihari" 
   if (varel >= 4) { 
     dimrel = 'https://telegra.ph/file/8ed7c08f3c53efb3250e8.jpg' 
   } 
   if (varel > 10) { 
     dimrel = 'https://telegra.ph/file/6e44f7a0ca634419fd6fe.jpg' 
   } 
   if (varel >= 15) { 
     dimrel = 'https://telegra.ph/file/5d0efe9615a43d069d9fb.jpg' 
   } 
   if (varel >= 18) { 
     dimrel = 'https://telegra.ph/file/b823c87f29294bf3bb9eb.jpg' 
   } 
   return dimrel 
 } 
 function ucapan() { 
   const time = moment.tz('Asia/Jakarta').format('HH') 
   res = "Selamat dinihari" 
   if (time >= 4) { 
      res = "Selamat pagi" 
   } 
   if (time > 10) { 
     res = "Selamat siang" 
   } 
   if (time >= 15) { 
     res = "Selamat sore" 
   } 
   if (time >= 18) { 
     res = "Selamat malam" 
   } 
   return res 
 }
  
  async function genProfile(conn, m) { 
   let font = await jimp.loadFont('./name.fnt'), 
     mask = await jimp.read('https://i.imgur.com/552kzaW.png'), 
     welcome = await jimp.read(thumbnailUrl.getRandom()), 
     avatar = await jimp.read(await conn.profilePictureUrl(m.sender, 'image').catch(() => 'https://telegra.ph/file/24fa902ead26340f3df2c.png')), 
     status = (await conn.fetchStatus(m.sender).catch(console.log) || {}).status?.slice(0, 30) || 'Not Detected' 
  
     await avatar.resize(460, 460) 
     await mask.resize(460, 460) 
     await avatar.mask(mask) 
     await welcome.resize(welcome.getWidth(), welcome.getHeight()) 
  
     await welcome.print(font, 550, 180, 'Name:') 
     await welcome.print(font, 650, 255, m.pushName.slice(0, 25)) 
     await welcome.print(font, 550, 340, 'About:') 
     await welcome.print(font, 650, 415, status) 
     await welcome.print(font, 550, 500, 'Number:') 
     await welcome.print(font, 650, 575, PhoneNumber('+' + m.sender.split('@')[0]).getNumber('international')) 
     return await welcome.composite(avatar, 50, 170).getBufferAsync('image/png') 
 }
